\section{简介}
\label{sec:sgxdedup-introduction}

将数据存储管理外包到云端是客户（企业或个人）节省自行管理海量数据开销的常用方案，\textit{安全性}和\textit{存储效率} 是实际外包存储的两大目标。为了满足这两个目标，本文探索了 \textit{（加密后重复数据删除（encrypted deduplication）}，这是一种通过始终将重复的明文数据块（来自相同或不同的客户端）加密为重复的密文数据块，并使用从块内容本身派生的密钥来结合加密和重复数据删除的范例；例如，密钥可以是相应块 \cite{douceur2002reclaiming} 的加密哈希。因此，可以通过重复数据删除来消除任何重复的密文数据块以提高存储效率，同时对所有外包块进行加密以防止未经授权的访问。加密后重复数据删除特别适用于备份应用程序，这些应用程序具有高内容冗余 \cite{wallace12} 并且是外包存储 \cite{hasan05,kotla07,varble09} 的有吸引力的用例。
  
现有的加密后重复数据删除方法通常会产生很高的性能开销来实现安全保证。本文使用最先进的加密后重复数据删除系统 {\em DupLESS} \cite{bellare2013DupLESS} 作为代表性示例来解释性能问题（详见\S\ref{subsec:sgxdedup-encrypted-dedup}）。首先，为了防止对手推断出内容派生的密钥，{\em DupLESS} 采用了 \textit{服务器辅助密钥管理（server-aided key management）}，其中部署了一个专用的密钥管理器来管理来自客户端的密钥生成请求。但是，服务器辅助密钥管理需要昂贵的加密操作，以防止密钥管理器在密钥生成期间知道明文数据块和密钥。其次，为了防止对手通过推断重复数据删除模式（又名旁道攻击\cite{harnik2010side, halevi2011proofs}）获得对密文数据块的未经授权的访问，{\em DupLESS} 可以采用以下方法之一: （i）执行 \textit{基于存储目标的重复数据删除}（即上传所有密文数据块并让云删除任何重复的密文数据块）以便保护重复数据删除模式免受任何（恶意）客户端的影响，或（ii）执行\textit{源端重复数据删除}（即，删除客户端上所有重复的密文数据块而不上传到云），另外向云证明它确实是密文数据块的所有者（即，可以访问相应明文数据块的全部内容）和被授权对密文数据块执行重复数据删除。前者需要额外的通信带宽来上传重复的密文数据块，而后者需要昂贵的密码操作来证明客户端是密文数据块的所有者。尽管已经提出了各种协议设计来解决加密后重复数据删除的性能问题，但它们往往会削弱安全性 \cite{li20b,xu2013weak,pietro12}，增加带宽开销 \cite{harnik10,li15}，或降低存储效率 \cite{zhou2015secdep, qin17,li20b}（详见 \S\ref{sec:sgxdedup-related_work}）。
  
硬件辅助可信执行 \cite{trustzone,sgx,MK-TME,AMDSEV} 的进步为提高加密后重复数据删除的性能提供了新的机会。特别是，本文专注于Intel软件保护扩展 (SGX)，它提供了一个 \textit{ 可信执行环境 (TEE)}，称为 \textit{ enclave}，用于处理具有机密性和完整性保证的代码和数据 \cite{baumann2014Shielding }。鉴于 SGX 通过适当的配置 \cite{harnik18} 实现了相当高的性能，本文有动力通过直接在安全区中运行敏感操作来卸载加密后重复数据删除的昂贵加密操作，从而提高加密后重复数据删除的性能，同时保持其安全性、带宽效率和存储效率。

本文提出了 \sysnameS，这是一个基于 SGX 的高性能加密后重复数据删除系统。 \sysnameS 建立在 {\em DupLESS} \cite{bellare2013DupLESS} 中的服务器辅助密钥管理之上，但在安全区内执行高效的加密操作。实现 \sysnameS 的设计具有不小的挑战。首先，安全地引导安全区以托管受信任的代码和数据至关重要，但证明安全区的真实性会导致显着延迟。其次，每个客户端都需要通过安全通道与密钥管理器内部的安全区进行通信，但安全通道的管理开销会随着客户端数量的增加而增加。最后，客户端可以续订或撤销云服务订阅，因此允许动态客户端身份验证至关重要。为此，本文为 \sysnameS 实现了三个主要构建块: 

\begin{itemize}[leftmargin=*]
    \item \textit{安全高效的安全区管理}:
        它可以防止密钥管理器受到破坏，并允许客户端在重新启动后快速引导安全区。
    \item \textit{自更新盲密钥管理}:
        它基于密钥回归 \cite{fu06} 生成一个盲密钥，用于保护密钥管理器内的安全区和每个客户端之间的通信，以便可以更新盲密钥以进行动态客户端身份验证。
    \item \textit{基于 Intel SGX的推测性加密}:
        它通过推测性加密 \cite{eduardo2019Speculative} 减轻了安全通道管理的在线加密/解密开销。
\end{itemize}

本文使用合成和真实的 \cite{fsl,meyer11} 工作负载来评估本文的 \sysnameS 原型。它通过将加密操作卸载到安全区来实现显着的加速（例如，与 {\em DupLESS} \cite{bellare2013DupLESS} 中的原始密钥生成方案相比，密钥生成加速了 131.9$\times$，在 Merkle-tree 上计算 PoW 加速了 8.2$\times$ -基于 PoW \cite{halevi11}）。对于非重复和重复数据的上传，它还分别比 {\em DupLESS} \cite{bellare2013DupLESS} 实现了 8.1$\times$ 和 9.6$\times$ 的加速，并且在实际中节省了高达 99.2\% 的带宽/存储 -世界工作量。本文在 {\bf http://adslab.cse.cuhk.edu.hk/software/sgxdedup} 上发布了本文的 \sysnameS 原型的源代码。 

