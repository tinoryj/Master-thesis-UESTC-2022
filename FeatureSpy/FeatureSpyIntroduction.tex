\section{简介}
\label{sec:featurespy-intro}

现有加密后重复数据删除中的数据所有权证明机制不足以完全击败恶意客户端(参见\S\ref{subsubsec:intro-problem-security})。即使通过数据块级的所有权证明保护源端重复数据删除，攻击者仍可通过枚举可能的数据内容发起推测内容攻击(Learning-content attack)\cite{harnik2010side, zuo2018mitigating}。具体来说，攻击者先验的了解数据文件的大部分格式化内容(例如，工资单)，并旨在识别其他客户端拥有的文件的私有部分(例如，工资单中的实际工资和奖金)。攻击者通过枚举私有内容的可能取值来伪造大量文件，并对每个文件执行源端重复数据删除，最终在某些文件无需上传任何数据块时推断目标私有信息的取值。

本文扩展了以前的研究\cite{harnik2010side, zuo2018mitigating}，证明在实践中推测内容攻击的严重性。具体来说，通过一个案例研究(参见\S\ref{sec:featurespy-attack})，本文说明针对具有较低信息熵(例如，包含数千个枚举取值)的文件，推测内容攻击可在本地局域网络环境中以不超过2分钟的时间开销完成攻击，而在真实云环境下也仅需8分钟左右完成。本文认为数据所有权证明无法阻止推测内容攻击，因为攻击者可以访问伪造文件的全部内容并且能向云服务端证明其对这些文件的所有权。

本章提出了\sysnameF，它通过主动检测每个客户端中的推测内容攻击来增强加密后重复数据删除的安全性。本文研究发现发起推测内容攻击的客户端具有较短时间内处理大量相似数据块(来自大量伪造的文件)的行为特征，且这些相似数据块中的信息修改仅限于针对数据块内容的小范围修改。另一方面，本文的研究表明，正常工作负载(未发生推测内容攻击)中的连续数据块(可能一起处理)彼此之间存在显着差异。因此，\sysnameF 在客户端可信执行环境(参见\S\ref{sec:background-tee})中检查所处理数据块的相似性，若客户端在短时间内处理了大量相似数据块，则判定为推测内容攻击可能发生，最终实现针对恶意客户端的主动侦测。

\sysnameF 建立在本文提出的基于TEE的数据所有权证明(参见\S\ref{chapter:sgxdedup})方案的基础之上，该方案可确保重复数据删除仅发生在经过安全区处理的加密数据块上。\sysnameF 基于加密数据块检测相似性，并将检测过程与安全区中的数据所有权证明耦合，以防止恶意客户端绕过检测过程。具体来说，\sysnameF 提出了相似性保留加密(Similarity-preserving
encryption, SPE)，相似性保留加密为消息锁加密增加了加密后数据的相似性保留能力，除了消息锁加密密钥，其额外根据原始数据的内容特征推导出特征密钥(Feature key)。由于相似的原始数据很可能具有相同的特征密钥，相似性保留加密使用特征密钥加密一小部分原始内容(称为指标(Indicator))以保留相似性，并使用消息锁加密方案加密剩余的大部分内容以确保数据安全性。由于相似数据仅在少数区域不同，\sysnameF 通过比较使用特征密钥加密的小部分来检测原始数据是否相似。

本章实验分析表明\sysnameF 可以有效地检测推测内容攻击(例如，在本文的案例研究中，检测率最低为98.6\%)，而产生误判的概率很低(例如，\sysnameF 的默认配置条件下为误判率为零)。此外，本文将\sysnameF 部署到基于TEE的高性能加密重复数据删除系统\sysnameS 中(关于\sysnameS 的相关设计参见\S\ref{chapter:sgxdedup})，以提高其应对推测内容攻击的安全性。本章提出的\sysnameF 的原型实现(即\prototype)相较于\sysnameS 增加的额外性能开销在基于真实世界数据集的性能测试中低至8.8\%(上传)和0.8\%(下载)。